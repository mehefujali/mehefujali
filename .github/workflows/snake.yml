name: Generate GitHub Snake Animation

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:
  # push:
  #   branches:
  #     - main

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Generate Snake SVG
        uses: Platane/snk@v3
        id: snake # Step ID
        with:
          github_user_name: ${{ github.repository_owner }}
          # 'outputs' ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶™‡¶æ‡¶• ‡¶è‡¶¨‡¶Ç ‡¶®‡¶æ‡¶Æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü
          # ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü‡¶∞‡ßÇ‡¶™‡ßá ‡¶è‡¶ü‡¶ø dist/github-snake.svg ‡¶è‡¶¨‡¶Ç dist/github-snake-dark.svg ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá
          # ‡¶è‡¶¨‡¶Ç ‡¶ó‡ßç‡¶∞‡¶ø‡¶°-‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø dist/ocean.svg ‡¶ì dist/ocean-dark.svg ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
          # ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ github-snake.svg ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßã
          outputs: dist/github-snake.svg # ,dist/github-snake-dark.svg?palette=github-dark # ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶°‡¶ì ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®

      - name: Commit and Push SVG
        run: |
         
          SVG_FILE_PATH="dist/github-snake.svg" # outputs ‡¶è ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡¶æ‡¶•‡¶ü‡¶ø

          echo "Checking for generated SVG at $SVG_FILE_PATH ..."
          if [ ! -f "$SVG_FILE_PATH" ]; then
            echo "--------------------------------------------------------------------"
            echo "ERROR: Snake SVG file was not found at '$SVG_FILE_PATH' after the generation step."
            echo "This means the 'Platane/snk@v3' action might have failed to create the SVG."
            echo "Please check the logs for the 'Generate Snake SVG' step for any errors from that action."
            echo "Listing contents of 'dist' directory (if it exists):"
            ls -la dist || echo "'dist' directory not found or is empty."
            echo "--------------------------------------------------------------------"
            exit 1
          fi
          echo "Snake SVG file found at $SVG_FILE_PATH. Proceeding with commit."
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add "$SVG_FILE_PATH" # ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ö‡¶æ‡¶á‡¶≤‡ßá dist ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶¨ SVG ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®: git add dist/*.svg
          if git diff --staged --quiet "$SVG_FILE_PATH"; then
            echo "No changes detected in the snake animation file ($SVG_FILE_PATH)."
          else
            echo "Changes detected. Committing and pushing..."
            git commit -m "chore: generate snake animation üêç"
            git push
            echo "Snake animation pushed successfully."
          fi
